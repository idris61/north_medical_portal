{% extends "templates/web.html" %}
{% from "erpnext/templates/includes/macros.html" import product_image %}

{% block title %}{{ doc.name }}{% endblock %}

{% block header %}
	<h3 class="m-0">{{ doc.name }}</h3>
{% endblock %}

{% block header_actions %}
	<div class="row">
		<div class="col-auto">
			<a class="btn btn-sm btn-secondary"
				href='/printview?doctype={{ doc.doctype}}&name={{ doc.name }}&format={{ print_format }}' target="_blank"
				rel="noopener noreferrer">
				<i class="fa fa-print"></i> {{ _("Print") }}
			</a>
		</div>
	</div>
{% endblock %}

{% block page_content %}
	<div>
		<div class="row transaction-subheading mt-1">
			<div class="col-6 text-muted small mt-1">
				{{ frappe.format_date(doc.posting_date) if doc.posting_date else frappe.format_date(doc.creation) }}
			</div>
		</div>
		<div class="row indicator-container mt-2">
			<div class="col-10">
				{% if doc.docstatus == 0 %}
					<span class="indicator-pill darkgrey">{{ _("Draft") }}</span>
				{% elif doc.docstatus == 1 %}
					<span class="indicator-pill blue">
						<span class="indicator-dot"></span> {{ _("Submitted") }}
					</span>
				{% elif doc.docstatus == 2 %}
					<span class="indicator-pill red">{{ _("Cancelled") }}</span>
				{% endif %}
			</div>
		</div>

		<div class="row mt-3 mb-3">
			<div class="col-sm-6">
				<strong>{{ _("Depo") }}:</strong> {{ doc.from_warehouse or doc.to_warehouse or "-" }}
			</div>
			<div class="col-sm-6 text-right">
				<strong>{{ _("Tip") }}:</strong> {{ doc.stock_entry_type or doc.purpose or "-" }}
			</div>
		</div>

		{% if doc.remarks %}
		<div class="row mt-2 mb-3">
			<div class="col-sm-12">
				<strong>{{ _("Notlar") }}:</strong> {{ doc.remarks }}
			</div>
		</div>
		{% endif %}

		<div class="order-container mt-4">
			<!-- items -->
			<div class="w-100">
				<div class="order-items order-item-header mb-1 row text-muted">
					<span class="col-5">
						{{ _("Ürün") }}
					</span>
					<span class="col-2">
						{{ _("Miktar") }}
					</span>
					<span class="col-2">
						{{ _("Birim") }}
					</span>
					<span class="col-3 text-right">
						{{ _("Depo") }}
					</span>
				</div>
				{% for item in doc.items %}
				<div class="order-items row align-items-center py-2">
					<span class="order-item-name col-5 pr-0">
						<div class="d-flex align-items-center">
							<div class="order-image-col mr-3 flex-shrink-0">
								<div class="order-image">
									{% if item.thumbnail %}
										{{ product_image(item.thumbnail, no_border=True) }}
									{% else %}
										<div class="no-image-cart-item">
											{{ frappe.utils.get_abbr(item.item_name or item.item_code) or "NA" }}
										</div>
									{% endif %}
								</div>
							</div>
							<div class="flex-grow-1">
								<strong class="d-block">{{ item.item_code }}</strong>
								{% if item.item_name and item.item_name != item.item_code %}
									<div class="text-muted small">{{ item.item_name }}</div>
								{% endif %}
							</div>
						</div>
					</span>
					<span class="col-2 pl-10">
						{{ item.get_formatted("qty") }}
					</span>
					<span class="col-2">
						{{ item.uom or item.stock_uom }}
					</span>
					<span class="col-3 text-right">
						{{ item.s_warehouse or item.t_warehouse or "-" }}
					</span>
				</div>
				{% endfor %}
			</div>
		</div>
	</div>

	{% if attachments %}
		<div class="order-item-table mt-4">
			<div class="row order-items order-item-header text-muted">
				<div class="col-sm-12 h6 text-uppercase">
					{{ _("Ekler") }}
				</div>
			</div>
			<div class="row order-items">
				<div class="col-sm-12">
					{% for attachment in attachments %}
					<p class="small">
						<a href="{{ attachment.file_url }}" target="blank"> {{ attachment.file_name }} </a>
					</p>
					{% endfor %}
				</div>
			</div>
		</div>
	{% endif %}

<style>
.order-image-col {
	width: 80px;
	flex-shrink: 0;
}

.order-image {
	width: 80px;
	height: 80px;
	display: flex;
	align-items: center;
	justify-content: center;
	overflow: hidden;
	border-radius: 4px;
	background-color: #f5f5f5;
}

.order-image img {
	width: 100%;
	height: 100%;
	object-fit: cover;
}

.no-image-cart-item {
	width: 80px;
	height: 80px;
	display: flex;
	align-items: center;
	justify-content: center;
	font-size: 24px;
	font-weight: bold;
	color: #999;
	background-color: #f5f5f5;
	border-radius: 4px;
}

.order-items {
	border-bottom: 1px solid #e0e0e0;
}

.order-items:last-child {
	border-bottom: none;
}

.indicator-pill.blue .indicator-dot {
	display: inline-block;
	width: 8px;
	height: 8px;
	background-color: #007bff;
	border-radius: 50%;
	margin-right: 0.5rem;
	vertical-align: middle;
}
</style>
{% endblock %}
