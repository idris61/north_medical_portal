{% extends "templates/web.html" %}
{% from "erpnext/templates/includes/macros.html" import product_image %}

{% block breadcrumbs %}
	{% include "templates/includes/breadcrumbs.html" %}
{% endblock %}

{% block title %}{{ doc.name }}{% endblock %}

{% block header %}
	<h3 class="m-0">{{ doc.name }}</h3>
{% endblock %}

{% block header_actions %}
<a class='btn btn-sm btn-secondary' href='/printview?doctype={{ doc.doctype}}&name={{ doc.name }}&format={{ print_format }}' target="_blank" rel="noopener noreferrer">
	<i class="fa fa-print"></i> {{ _("Print") }}
</a>
{% endblock %}

{% block page_content %}

<div class="row transaction-subheading">
	<div class="col-xs-6">

		<span class="indicator {{ doc.indicator_color or ("blue" if doc.docstatus==1 else "gray") }}">
			{{ _(doc.get('indicator_title')) or _(doc.status) or _("Submitted") }}
		</span>
	</div>
	<div class="col-xs-6 text-muted text-right small">
		{{ frappe.utils.format_date(doc.transaction_date, 'medium') }}
	</div>
</div>

<div class="row mt-3 mb-3">
	<div class="col-12">
		<table class="table table-sm table-borderless mb-0" style="font-size: 0.9rem;">
			<tbody>
				<tr>
					<td class="text-muted" style="width: 150px; font-weight: 600;">{{ _("Requested By") }}:</td>
					<td>{{ doc.requested_by_name or doc.owner_name or frappe.utils.get_fullname(doc.owner) or doc.owner or "-" }}</td>
				</tr>
				<tr>
					<td class="text-muted" style="width: 150px; font-weight: 600;">{{ _("Target Warehouse") }}:</td>
					<td>{{ doc.target_warehouse_display or "-" }}</td>
				</tr>
				{% if doc.schedule_date %}
				<tr>
					<td class="text-muted" style="width: 150px; font-weight: 600;">{{ _("Planned Date") }}:</td>
					<td>{{ frappe.utils.format_date(doc.schedule_date, 'medium') }}</td>
				</tr>
				{% endif %}
			</tbody>
		</table>
	</div>
</div>

{% if doc._header %}
{{ doc._header }}
{% endif %}

<div class="order-container">

	<!-- items -->
	<div class="order-item-table">
		<div class="row order-items order-item-header text-muted">
			<div class="col-sm-8 col-xs-8 h6 text-uppercase">
				{{ _("Item") }}
			</div>
			<div class="col-sm-4 col-xs-4 text-right h6 text-uppercase">
				{{ _("Quantity") }}
			</div>
		</div>
		{% for d in doc.items %}
		<div class="row order-items">
			<div class="col-sm-8 col-xs-8">
				<div class="row item_name_and_description">
					<div class="col-xs-4 col-sm-2 order-image-col">
						<div class="order-image h-100">
							{% if d.thumbnail %}
								{{ product_image(d.thumbnail, no_border=True) }}
							{% else %}
								<div class="no-image-cart-item" style="min-height: 100px;">
									{{ frappe.utils.get_abbr(d.item_name or d.item_code) or "NA" }}
								</div>
							{% endif %}
						</div>
					</div>
					<div class="col-xs-8 col-sm-10">
						<strong>{{ d.item_code or d.item_name }}</strong>
						{% if d.item_name and d.item_name != d.item_code %}
						<div class="text-muted small">{{ d.item_name }}</div>
						{% endif %}
						{% if d.description %}
						<div class="text-muted small item-description">
							{{ d.description[:100] }}{% if d.description|length > 100 %}...{% endif %}
						</div>
						{% endif %}
						{% if d.warehouse and not doc.set_warehouse %}
						<div class="text-muted small mt-1">
							<i class="fa fa-warehouse"></i> {{ _("Target Warehouse") }}: {{ d.warehouse }}
						</div>
						{% endif %}
					</div>
				</div>
			</div>
			<div class="col-sm-4 col-xs-4 text-right">
				<strong>{{ d.qty }}</strong> {{ d.uom or d.stock_uom }}
				{% if d.delivered_qty is defined and d.delivered_qty != None %}
				<p class="text-muted small">
					{{ _("Delivered: {0}").format(d.delivered_qty) }}
				</p>
				{% endif %}
				{% if d.ordered_qty %}
				<p class="text-muted small">
					{{ _("Ordered: {0}").format(d.ordered_qty) }}
				</p>
				{% endif %}
			</div>
		</div>
		{% endfor %}
	</div>
</div>
{% endblock %}

